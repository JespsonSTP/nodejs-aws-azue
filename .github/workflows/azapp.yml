name: deploy to container instances

on:
 workflow_dispatch:
 pull_request:
  branches:
    - main

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout Repository
            uses: actions/checkout@v2

          - name: Log in with Azure
            uses: azure/login@v1
            with:
              creds: '${{ secrets.AZURE_CREDENTIALS }}'

          - name: 'Build and push image'
            uses: azure/docker-login@v1}
            run: |
              docker login devimpressoapiacr.azurecr.io --username devimpressoapiacr --password dHcWJDooV7YqiY46bAdh+G6YUqtVls8mvCA9ngrIEh+ACRDGuUVR
              docker build . -t devimpressoapiacr.azurecr.io/impressoapi:${{ github.sha }}
              docker push devimpressoapiacr.azurecr.io/impressoapi:${{ github.sha }}
